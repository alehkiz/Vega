{% extends 'base.html' %}
{% from "macros/form.html" import render_field %}
{% from "macros/main.html" import render_pagination %}

{% block app_content %}
<main class="conteiner">
    <div class='row'>
        <div class="col-md-8">
            
            {% if mode == 'search' %}
            {% if pagination.total == 0 %}
                Nenhum resultado encontrado
            <div class="d-flex justify-content-between mt-5">
            <a type="button" class="btn btn-info" href="{{url_for('question.index')}}">Voltar</a>
            </div>
            {% else %}
                {% for item in pagination.items %}
                <div class="alert alert-dark" role="alert">
                    <p class="fw-bold">Q: </p>
                    {{item[0].question}}
                    {% if current_user.can_edit %}
                    <a href="{{url_for('question.remove', id=item[0].id)}}"
                            class="text-decoration-none btn btn-danger btn-sm float-end"><i class="icon-remove"></i></a>
                    <a href="{{url_for('question.edit', id=item[0].id)}}"
                            class="text-decoration-none btn btn-success btn-sm float-end"><i class="icon-edit"></i></a>
                            {% endif %}  
                            <!-- <hr> 
                            {% if item[0].answered %}
                            {{item[0].answer}}
                            {% endif %} -->
                        </div>
                {% endfor %}
                {{ render_pagination(pagination, first_page, last_page, 'question.search', url_arguments=url_arguments)}}
                {% endif %}

            {% endif %}
            {% if questions %}
            {% for question in questions %}
            <article class="article-post">
                <div class="article-header">
                    <!-- <h4>
                        <a href="{{url_for('question.view', id=question.id)}}"
                            class="text-decoration-none">{{question.title}}</a>
                        <a href="{{url_for('question.view', id=question.id)}}"
                            class="text-decoration-none">{{question.title}}</a>
                        {% if current_user.can_edit %}

                        <a href="{{url_for('question.edit', id=question.id)}}"
                            class="text-decoration-none btn btn-success btn-sm"><i class="icon-edit"></i></a>
                        <a href="{{url_for('question.remove', id=question.id)}}"
                            class="text-decoration-none btn btn-danger btn-sm"><i class="icon-remove"></i></a>

                        {% endif %}
                    </h4> -->

                    {#<p class="article-meta">
                        {{question.get_create_time_elapsed}} por <a
                            href="{{ url_for('user.view', id=question.author.id) }}"
                            class="text-decoration-none">{{question.author.name}}</a>
                        em <a href="{{ url_for('wiki.topic', topic_name=question.topic.format_name)}}"
                            class="text-decoration-none">{{question.topic.name}}</a>

                    </p>#}
                </div>
                <div class="alert alert-dark" role="alert">
                    <span class="fw-bold">Q: </span>
                    <a href="{{url_for('question.view', id=question.id)}}" class='badge bg-info text-dark text-wrap text-break text-decoration-none'>
                    {{question.question}}</a>
                    {% if current_user.can_edit %}
                    <a href="{{url_for('question.remove', id=question.id)}}"
                            class="text-decoration-none btn btn-danger btn-sm float-end"><i class="icon-remove"></i></a>
                    <a href="{{url_for('question.edit', id=question.id)}}"
                            class="text-decoration-none btn btn-success btn-sm float-end"><i class="icon-edit"></i></a>
                            {% endif %}  
                            <!-- <hr> 
                             {% if question.answered %}
                             <span class="fw-bold">R: </span>
                             {{question.answer}}
                             {% endif %} -->
                        </div>
                    <!-- {% if question.answered %}
                    <div class="alert alert-info" role="alert">
                        {{question.answer}}
                    </div>
                    {% endif %} -->
                
            </article>
            {% endfor %}
            {% endif %}
    {% if mode == 'view' %}
    <article class="article-post">
        <div class="article-header">
            <h1 class="article-title">
                {{question.question}}
            </h1>
            <!-- <p class="lead article-description">
                
            </p> -->
            <p class="article-meta">
                Criado {{question.get_create_time_elapsed}} por <a href='#'>{{question.author.name}}</a> 
                <!-- TODO: Finalizar -->
                {% if question.was_updated() %}
                <br>
                {{'Atualizado '+ question.get_update_time_elapsed if question.get_update_time_elapsed else ''}} por <a href='#'>{{article.updater.name}}</a> 
                {% endif %}
            </p>
        </div>
        <div class="article-text">
            {{question.answer}}
        </div>
        {% if question.tag != none %}
        <div class="article-tag card border-dark">
            <div class="card-header">Tags</div>
            <div class="card-body text-dark">
                <p class="card-text">
                    <a href="{{url_for('wiki.tag', tag_name=question.tag.name)}}">{{question.tag.name}}</a> 
                </p>
            </div>
        </div>
        {% endif %}
    </article>
    
    
    {% endif %}
</div>
    {% if cls_question.most_viewed(config['ITEMS_PER_PAGE']) | length > 0 %}
    <div class="col-md-4">
        <div class="p-4 mb-3 bg-light rounded">
            <h4 class="font-italic">Mais visualizados</h4>
            {% for question in cls_question.most_viewed(config['ITEMS_PER_PAGE']) %}
            <p class="mb-0"><a href="{{url_for('question.view', id=question.id)}}"
                    class="text-decoration-none">{{question.question[0:50]}}</a></p>
            {% endfor %}
        </div>
    </div>
    {% endif %}
</div>
</main>

{% endblock %}